<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Command Center - 실시간 대시보드</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. Recharts (차트 라이브러리) -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>

    <style>
        html, body, #root {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #f1f5f9;
        }
        /* 커스텀 스크롤바 */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body>
    <div id="root" class="h-full flex items-center justify-center">
        <!-- 로딩 전 기본 화면 -->
        <div class="animate-pulse text-slate-400">대시보드 로딩 중...</div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- [아이콘 직접 구현] 외부 의존성 없이 SVG로 직접 그리기 ---
        const Icon = ({ children, size = 16, className = "", color = "currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Icons = {
            LayoutDashboard: (props) => <Icon {...props}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></Icon>,
            RefreshCw: (props) => <Icon {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>,
            Settings: (props) => <Icon {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>,
            Briefcase: (props) => <Icon {...props}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></Icon>,
            Phone: (props) => <Icon {...props}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></Icon>,
            Mail: (props) => <Icon {...props}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></Icon>,
            Layers: (props) => <Icon {...props}><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></Icon>,
            FileText: (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></Icon>,
            DollarSign: (props) => <Icon {...props}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></Icon>,
            Crown: (props) => <Icon {...props}><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></Icon>,
            Award: (props) => <Icon {...props}><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></Icon>,
            User: (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>,
            Database: (props) => <Icon {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></Icon>,
            LinkIcon: (props) => <Icon {...props}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></Icon>,
            CheckCircle2: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></Icon>
        };

        // --- 유틸리티 함수 ---
        const parseCSV = (str) => {
            const arr = [];
            let quote = false, col = 0, row = 0;
            arr[row] = arr[row] || [];
            arr[row][col] = arr[row][col] || '';
            for (let c = 0; c < str.length; c++) {
                let cc = str[c], nc = str[c+1];
                if (cc === '"' && quote && nc === '"') { arr[row][col] += cc; ++c; continue; }
                if (cc === '"') { quote = !quote; continue; }
                if (cc === ',' && !quote) { ++col; arr[row][col] = ''; continue; }
                if (cc === '\r' && nc === '\n' && !quote) { ++row; col = 0; ++c; arr[row] = []; continue; }
                if (cc === '\n' && !quote) { ++row; col = 0; arr[row] = []; continue; }
                if (cc === '\r' && !quote) { ++row; col = 0; arr[row] = []; continue; }
                arr[row][col] += cc;
            }
            return arr;
        };

        const extractGid = (input) => {
            if (!input) return '';
            try {
                if (/^\d+$/.test(input)) return input;
                const url = new URL(input);
                return url.searchParams.get('gid') || input;
            } catch (e) {
                const match = input.match(/gid=(\d+)/);
                return (match && match[1]) ? match[1] : input;
            }
        };

        const parseCurrency = (str) => {
            if (!str) return 0;
            const cleanStr = str.toString().replace(/[^0-9.-]/g, '');
            const num = parseFloat(cleanStr);
            return isNaN(num) ? 0 : Math.floor(num);
        };

        const formatKoreanCurrency = (val) => {
            if (!val || val === 0) return '0';
            if (val >= 100000000) return `${(val / 100000000).toFixed(1)}억`;
            if (val >= 10000) return `${(val / 10000).toFixed(0)}만`;
            return val.toLocaleString();
        };

        const CHART_COLORS = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ec4899', '#6366f1'];
        const MOCK_ACTIVITY = [{ person: '김철수', type: '아웃바운드' }, { person: '이영희', type: '메일 영업' }];
        const MOCK_SALES = [[null, '2025-01', '김철수', 'A고객사', '1', null, null, '₩50,000,000']];

        // --- 메인 컴포넌트 ---
        function SalesDashboard() {
            // Recharts 로딩 상태 관리
            const [rechartsLoaded, setRechartsLoaded] = useState(false);
            
            useEffect(() => {
                // Recharts가 로드될 때까지 확인
                const interval = setInterval(() => {
                    if (window.Recharts) {
                        setRechartsLoaded(true);
                        clearInterval(interval);
                    }
                }, 100);
                return () => clearInterval(interval);
            }, []);

            if (!rechartsLoaded) {
                return <div className="h-full flex items-center justify-center text-slate-400">차트 라이브러리 로딩 중...</div>;
            }

            // 안전하게 Recharts 컴포넌트 가져오기
            const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LabelList } = window.Recharts;
            
            // 데이터 상태
            const [activityData, setActivityData] = useState([]);
            const [salesData, setSalesData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [salesPreviewRow, setSalesPreviewRow] = useState([]);
            const [showSettings, setShowSettings] = useState(false);

            // 설정
            const SHEET_ID = '1W0OXOMzCvq6KlBwWpnnXQTgcOaC1gK4zftTEq5qmfns';
            const [activityGid, setActivityGid] = useState('0');
            const [salesGid, setSalesGid] = useState('1883872851');
            const [tempSalesInput, setTempSalesInput] = useState('');

            // 컬럼 매핑
            const [colMap, setColMap] = useState({
                manager: 2,   // C열
                client: 3,    // D열
                count: 4,     // E열
                revenue: 7    // H열
            });

            // 데이터 불러오기 함수
            const fetchData = async () => {
                setLoading(true);
                const getCsvUrl = (id, gid) => `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`;
                
                try {
                    const actRes = await fetch(getCsvUrl(SHEET_ID, activityGid));
                    if (actRes.ok) {
                        const text = await actRes.text();
                        const parsed = parseCSV(text);
                        // 헤더 제외, 데이터 매핑
                        const data = parsed.slice(1).map(row => ({ 
                            person: row[2], // C열
                            type: row[3]    // D열
                        })).filter(r => r.person && r.type);
                        setActivityData(data);
                    }
                } catch (e) { setActivityData(MOCK_ACTIVITY); }

                try {
                    const salesRes = await fetch(getCsvUrl(SHEET_ID, salesGid));
                    if (salesRes.ok) {
                        const text = await salesRes.text();
                        const parsed = parseCSV(text);
                        setSalesData(parsed.slice(1));
                        if (parsed.length > 1) setSalesPreviewRow(parsed[1]);
                    }
                } catch (e) { setSalesData(MOCK_SALES); }
                setLoading(false);
            };

            // 초기 로딩 및 주기적 갱신
            useEffect(() => {
                fetchData();
                const interval = setInterval(fetchData, 60000);
                return () => clearInterval(interval);
            }, []);

            const handleApplySettings = () => {
                if (tempSalesInput) setSalesGid(extractGid(tempSalesInput));
                setTimeout(() => { fetchData(); setShowSettings(false); }, 100);
            };

            // 데이터 가공 로직
            const processedActivityGroups = useMemo(() => {
                const groups = {};
                (activityData.length ? activityData : MOCK_ACTIVITY).forEach(item => {
                    const p = item.person;
                    const t = item.type ? item.type.trim() : '기타';
                    if (!p) return;
                    if (!groups[t]) groups[t] = {};
                    groups[t][p] = (groups[t][p] || 0) + 1;
                });
                return Object.keys(groups).map(type => {
                    const data = Object.entries(groups[type])
                        .map(([name, count]) => ({ name, count }))
                        .sort((a, b) => b.count - a.count);
                    const totalCount = data.reduce((a, c) => a + c.count, 0);
                    return { type, data, totalCount };
                }).sort((a, b) => b.totalCount - a.totalCount);
            }, [activityData]);

            const processedSales = useMemo(() => {
                const aggregated = {};
                (salesData.length ? salesData : MOCK_SALES).forEach(row => {
                    const manager = row[colMap.manager];
                    const client = row[colMap.client];
                    const countStr = row[colMap.count];
                    const revStr = row[colMap.revenue];

                    if (!manager) return;
                    if (!aggregated[manager]) {
                        aggregated[manager] = { 담당자: manager, 매출액: 0, 계약건수: 0, 계약처목록: [] };
                    }
                    
                    let count = 0;
                    if (countStr && !isNaN(parseInt(countStr))) count = parseInt(countStr);
                    if (count > 0) {
                        aggregated[manager].계약건수 += count;
                        if (client) aggregated[manager].계약처목록.push(client);
                    }
                    if (revStr) {
                        aggregated[manager].매출액 += parseCurrency(revStr);
                    }
                });
                return Object.values(aggregated).map(item => ({ 
                    ...item, 
                    대표계약처: item.계약처목록[0] || '-' 
                }));
            }, [salesData, colMap]);

            // 차트용 필터링 (0값 제외)
            const chartData = useMemo(() => processedSales.filter(d => d.매출액 > 0 || d.계약건수 > 0), [processedSales]);
            const topSales = useMemo(() => [...processedSales].filter(d => d.매출액 > 0).sort((a, b) => b.매출액 - a.매출액).slice(0, 3), [processedSales]);
            const topContracts = useMemo(() => [...processedSales].filter(d => d.계약건수 > 0).sort((a, b) => b.계약건수 - a.계약건수).slice(0, 3), [processedSales]);

            const CustomBarLabel = ({ x, y, width, value, type }) => {
                if (!value || value === 0) return null;
                const displayValue = type === 'revenue' ? formatKoreanCurrency(value) : value;
                return <text x={x + width / 2} y={y - 5} fill="#fff" textAnchor="middle" dy={-6} fontSize={11} fontWeight="bold">{displayValue}</text>;
            };

            return (
                <div className="h-full flex flex-col overflow-hidden">
                    {/* Header */}
                    <nav className="bg-slate-800 border-b border-slate-700 px-4 py-3 flex-none">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-blue-600 p-2 rounded-lg">
                                    <Icons.LayoutDashboard size={18} className="text-white" />
                                </div>
                                <div>
                                    <h1 className="font-bold text-lg leading-tight text-white">Sales Command Center</h1>
                                    <p className="text-[10px] text-slate-400">실시간 통합 대시보드</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <button onClick={() => setShowSettings(!showSettings)} className="text-slate-400 hover:text-white flex items-center gap-1 text-xs bg-slate-700 px-2 py-1 rounded">
                                    <Icons.Settings size={14} /> 설정
                                </button>
                                <button onClick={fetchData} className={`text-slate-400 hover:text-white ${loading ? 'animate-spin' : ''}`}>
                                    <Icons.RefreshCw size={18} />
                                </button>
                            </div>
                        </div>
                        
                        {/* Settings Overlay */}
                        {showSettings && (
                            <div className="absolute top-14 right-4 z-50 w-[500px] bg-slate-800 border border-slate-600 rounded-lg shadow-2xl p-5 overflow-y-auto max-h-[80vh]">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-bold text-sm text-white flex items-center gap-2">
                                        <Icons.Database size={16} className="text-blue-400"/> 데이터 매핑 설정
                                    </h3>
                                    <button onClick={() => setShowSettings(false)} className="text-slate-400 hover:text-white text-xs">닫기</button>
                                </div>
                                <div className="mb-4">
                                    <label className="block text-[10px] text-slate-400 mb-1">매출 기록 시트 (URL)</label>
                                    <input type="text" value={tempSalesInput || salesGid} onChange={(e) => setTempSalesInput(e.target.value)} 
                                        className="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs text-white" placeholder="https://..." />
                                </div>
                                <div className="overflow-x-auto pb-2 mb-4">
                                    <div className="flex gap-2 min-w-max">
                                        {salesPreviewRow.map((cell, idx) => (
                                            <div key={idx} className="flex flex-col items-center">
                                                <div className={`w-20 h-6 flex items-center justify-center text-[10px] rounded border ${Object.values(colMap).includes(idx) ? 'border-blue-500 bg-blue-900/30 text-blue-200' : 'border-slate-700 text-slate-500'} truncate`}>{cell || '-'}</div>
                                                <span className="text-[9px] text-slate-500">Idx {idx}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-3 text-xs">
                                    <div><label className="block text-slate-400 mb-1">담당자 (C열=2)</label><input type="number" value={colMap.manager} onChange={(e) => setColMap({...colMap, manager: parseInt(e.target.value)})} className="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1"/></div>
                                    <div><label className="block text-slate-400 mb-1">계약처 (D열=3)</label><input type="number" value={colMap.client} onChange={(e) => setColMap({...colMap, client: parseInt(e.target.value)})} className="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1"/></div>
                                    <div><label className="block text-slate-400 mb-1">건수 (E열=4)</label><input type="number" value={colMap.count} onChange={(e) => setColMap({...colMap, count: parseInt(e.target.value)})} className="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1"/></div>
                                    <div><label className="block text-slate-400 mb-1">매출액 (H열=7)</label><input type="number" value={colMap.revenue} onChange={(e) => setColMap({...colMap, revenue: parseInt(e.target.value)})} className="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1"/></div>
                                </div>
                                <div className="mt-4 text-right"><button onClick={handleApplySettings} className="px-3 py-1.5 bg-blue-600 text-white text-xs rounded">저장</button></div>
                            </div>
                        )}
                    </nav>

                    {/* Main Content */}
                    <main className="flex-1 p-4 overflow-hidden">
                        <div className="grid grid-cols-12 grid-rows-[3fr_1fr] gap-4 h-full">
                            
                            {/* 1. Daily Activities */}
                            <div className="col-span-4 bg-slate-800/50 border border-slate-700/50 rounded-xl p-3 flex flex-col gap-2">
                                <div className="flex items-center gap-2 flex-none px-1">
                                    <Icons.Briefcase size={16} className="text-blue-400" />
                                    <h2 className="font-bold text-sm text-white">Daily Activities [일일 영업 활동]</h2>
                                </div>
                                <div className="flex-1 overflow-y-auto pr-1 space-y-2 min-h-0">
                                    {processedActivityGroups.map((group, idx) => (
                                        <div key={group.type} className="h-32 flex flex-col bg-slate-900/30 rounded-lg p-2 flex-shrink-0">
                                            <span className="text-[10px] text-slate-300 font-bold mb-1 flex items-center gap-1 truncate">
                                                <Icons.Layers size={10} style={{ color: CHART_COLORS[idx % CHART_COLORS.length] }} /> 
                                                {group.type} ({group.totalCount}건)
                                            </span>
                                            <div className="flex-1 min-h-0">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <BarChart data={group.data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
                                                        <CartesianGrid strokeDasharray="3 3" stroke="#334155" vertical={false} />
                                                        <XAxis dataKey="name" stroke="#94a3b8" tick={{fontSize: 10}} interval={0} />
                                                        <YAxis stroke="#94a3b8" tick={{fontSize: 10}} width={20} />
                                                        <Tooltip cursor={{fill: '#334155', opacity: 0.2}} contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', fontSize: '11px' }} />
                                                        <Bar dataKey="count" fill={CHART_COLORS[idx % CHART_COLORS.length]} radius={[3, 3, 0, 0]} maxBarSize={30}>
                                                            <LabelList dataKey="count" content={<CustomBarLabel />} />
                                                        </Bar>
                                                    </BarChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>
                                    ))}
                                    {processedActivityGroups.length === 0 && <div className="text-center text-xs text-slate-500 pt-4">데이터 없음</div>}
                                </div>
                            </div>

                            {/* 2. Contract Count */}
                            <div className="col-span-4 bg-slate-800/50 border border-slate-700/50 rounded-xl p-4 flex flex-col">
                                <div className="flex items-center gap-2 mb-2 flex-none">
                                    <Icons.FileText size={16} className="text-amber-400" />
                                    <h2 className="font-bold text-sm text-white">Contract Count [계약 건수]</h2>
                                </div>
                                <div className="flex-1 min-h-0">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart data={chartData.filter(d => d.계약건수 > 0)} margin={{ top: 15, right: 10, left: 0, bottom: 0 }}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#334155" vertical={false} />
                                            <XAxis dataKey="담당자" stroke="#94a3b8" tick={{fontSize: 11}} interval={0} />
                                            <YAxis stroke="#94a3b8" tick={{fontSize: 10}} allowDecimals={false} />
                                            <Tooltip cursor={{fill: '#334155', opacity: 0.2}} contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', fontSize: '12px' }} />
                                            <Bar dataKey="계약건수" name="계약 수" fill={COLORS.contract} radius={[4, 4, 0, 0]} maxBarSize={50}>
                                                <LabelList dataKey="계약건수" content={<CustomBarLabel />} />
                                            </Bar>
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            {/* 3. Revenue Status */}
                            <div className="col-span-4 bg-slate-800/50 border border-slate-700/50 rounded-xl p-4 flex flex-col">
                                <div className="flex items-center gap-2 mb-2 flex-none">
                                    <Icons.DollarSign size={16} className="text-emerald-400" />
                                    <h2 className="font-bold text-sm text-white">Revenue Status [매출 현황]</h2>
                                </div>
                                <div className="flex-1 min-h-0">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart data={chartData.filter(d => d.매출액 > 0).sort((a, b) => b.매출액 - a.매출액)} margin={{ top: 15, right: 10, left: 10, bottom: 0 }}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#334155" vertical={false} />
                                            <XAxis dataKey="담당자" stroke="#94a3b8" tick={{fontSize: 11}} interval={0} />
                                            <YAxis stroke="#94a3b8" tick={{fontSize: 10}} tickFormatter={(val) => val >= 10000 ? `${val/10000}만` : val} />
                                            <Tooltip cursor={{fill: '#334155', opacity: 0.2}} contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', fontSize: '12px' }} formatter={(val) => val.toLocaleString() + '원'}/>
                                            <Bar dataKey="매출액" name="매출" fill={COLORS.revenue} radius={[4, 4, 0, 0]} maxBarSize={50}>
                                                <LabelList dataKey="매출액" content={<CustomBarLabel type="revenue" />} />
                                            </Bar>
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            {/* Bottom: Top 3 Lists */}
                            <div className="col-span-12 grid grid-cols-1 md:grid-cols-2 gap-4 overflow-hidden">
                                {/* Sales Top 3 */}
                                <div className="bg-slate-800/50 border border-slate-700/50 rounded-xl overflow-hidden flex flex-col">
                                    <div className="px-4 py-2 bg-slate-700/30 border-b border-slate-700/50 flex items-center justify-between">
                                        <h3 className="font-bold text-sm text-white flex items-center gap-2">
                                            <Icons.Crown size={14} className="text-yellow-400"/> Sales Top 3 [매출 상위 3인]
                                        </h3>
                                    </div>
                                    <div className="flex-1 overflow-auto">
                                        <table className="w-full text-left text-sm text-slate-400">
                                            <thead className="bg-slate-700/50 text-slate-200 sticky top-0">
                                                <tr><th className="px-6 py-2 w-16 text-center">순위</th><th className="px-6 py-2">담당자</th><th className="px-6 py-2 text-right">매출액</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-700/50">
                                                {topSales.length > 0 ? topSales.map((row, idx) => (
                                                    <tr key={idx} className="hover:bg-slate-700/30">
                                                        <td className="px-6 py-2 text-center text-yellow-400 font-bold">{idx + 1}</td>
                                                        <td className="px-6 py-2 text-white">{row.담당자}</td>
                                                        <td className="px-6 py-2 text-right font-mono text-emerald-400 font-bold">{formatKoreanCurrency(row.매출액)}</td>
                                                    </tr>
                                                )) : <tr><td colSpan="3" className="px-6 py-4 text-center text-slate-500">데이터 없음</td></tr>}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Contract Top 3 */}
                                <div className="bg-slate-800/50 border border-slate-700/50 rounded-xl overflow-hidden flex flex-col">
                                    <div className="px-4 py-2 bg-slate-700/30 border-b border-slate-700/50 flex items-center justify-between">
                                        <h3 className="font-bold text-sm text-white flex items-center gap-2">
                                            <Icons.Award size={14} className="text-blue-400"/> Contract Details Top 3 [계약 상세 상위 3인]
                                        </h3>
                                    </div>
                                    <div className="flex-1 overflow-auto">
                                        <table className="w-full text-left text-sm text-slate-400">
                                            <thead className="bg-slate-700/50 text-slate-200 sticky top-0">
                                                <tr><th className="px-6 py-2 w-16 text-center">순위</th><th className="px-6 py-2">담당자</th><th className="px-6 py-2 text-right">건수</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-700/50">
                                                {topContracts.length > 0 ? topContracts.map((row, idx) => (
                                                    <tr key={idx} className="hover:bg-slate-700/30">
                                                        <td className="px-6 py-2 text-center text-blue-400 font-bold">{idx + 1}</td>
                                                        <td className="px-6 py-2 text-white">{row.담당자}</td>
                                                        <td className="px-6 py-2 text-right font-mono text-white">{row.계약건수}</td>
                                                    </tr>
                                                )) : <tr><td colSpan="3" className="px-6 py-4 text-center text-slate-500">데이터 없음</td></tr>}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<SalesDashboard />);
    </script>
</body>
</html>
